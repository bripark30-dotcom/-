import streamlit as st
import pandas as pd

# --------------------------------------------------------------------------
# 1. ì¥í•™ê¸ˆ ë°ì´í„°ë² ì´ìŠ¤ ìƒì„± (ê¸°ì¡´ ì½”ë“œì™€ ë™ì¼)
# --------------------------------------------------------------------------
def create_scholarship_df():
    """
    ì¥í•™ê¸ˆ ë°ì´í„°ë¥¼ pandas DataFrameìœ¼ë¡œ ìƒì„±í•˜ëŠ” í•¨ìˆ˜
    """
    data = [
        {'ì¥í•™ê¸ˆëª…': 'AIì„œìš¸í…Œí¬ ëŒ€í•™ì› ì¥í•™ê¸ˆ', 'êµ¬ë¶„': 'ëŒ€í•™ì›ìƒ', 'ì „ê³µ ê³„ì—´': 'ì´ê³µê³„ ë° ìì—°ê³¼í•™', 'ìš°ëŒ€ ì¡°ê±´': 'í•´ë‹¹ ì—†ìŒ', 'ê²½ì œìƒí™© ìš”ê±´': 'í•´ë‹¹ ì—†ìŒ'},
        {'ì¥í•™ê¸ˆëª…': 'ì„œìš¸í¬ë§ ëŒ€í•™ì§„ë¡œ ì¥í•™ê¸ˆ', 'êµ¬ë¶„': 'ëŒ€í•™ìƒ', 'ì „ê³µ ê³„ì—´': 'ì „ê³µë¬´ê´€', 'ìš°ëŒ€ ì¡°ê±´': 'í•´ë‹¹ ì—†ìŒ', 'ê²½ì œìƒí™© ìš”ê±´': 'ê¸°ì´ˆìƒí™œìˆ˜ê¸‰ì/ë²•ì •ì°¨ìƒìœ„ê³„ì¸µ, í•™ìê¸ˆì§€ì› 4êµ¬ê°„ ì´ë‚´'},
        {'ì¥í•™ê¸ˆëª…': 'ì„œìš¸í¬ë§ ê³µìµì¸ì¬ ì¥í•™ê¸ˆ', 'êµ¬ë¶„': 'ëŒ€í•™ìƒ', 'ì „ê³µ ê³„ì—´': 'ì „ê³µë¬´ê´€', 'ìš°ëŒ€ ì¡°ê±´': 'ì‚¬íšŒê³µí—Œí™œë™ ê²½í—˜ì', 'ê²½ì œìƒí™© ìš”ê±´': 'í•´ë‹¹ ì—†ìŒ'},
        {'ì¥í•™ê¸ˆëª…': 'ë…ë¦½ìœ ê³µì í›„ì† ì¥í•™ê¸ˆ', 'êµ¬ë¶„': 'ëŒ€í•™ìƒ', 'ì „ê³µ ê³„ì—´': 'ì „ê³µë¬´ê´€', 'ìš°ëŒ€ ì¡°ê±´': 'ë…ë¦½ìœ ê³µì í›„ì† (4~6ëŒ€)', 'ê²½ì œìƒí™© ìš”ê±´': 'í•´ë‹¹ ì—†ìŒ'},
        {'ì¥í•™ê¸ˆëª…': 'ì„œìš¸ í•´ì™¸êµí™˜í•™ìƒ ì¥í•™ê¸ˆ', 'êµ¬ë¶„': 'ëŒ€í•™ìƒ', 'ì „ê³µ ê³„ì—´': 'ì „ê³µë¬´ê´€', 'ìš°ëŒ€ ì¡°ê±´': 'í•´ì™¸êµí™˜í•™ìƒìœ¼ë¡œ ì„ ë°œëœ ì', 'ê²½ì œìƒí™© ìš”ê±´': 'ê¸°ì´ˆìƒí™œìˆ˜ê¸‰ì/ë²•ì •ì°¨ìƒìœ„ê³„ì¸µ, í•™ìê¸ˆì§€ì› 4êµ¬ê°„ ì´ë‚´'},
        {'ì¥í•™ê¸ˆëª…': 'ì²­ì¶˜Start ì¥í•™ê¸ˆ', 'êµ¬ë¶„': 'ëŒ€í•™ ì‹ ì…ìƒ', 'ì „ê³µ ê³„ì—´': 'ì „ê³µë¬´ê´€', 'ìš°ëŒ€ ì¡°ê±´': 'ë³µì§€ì‹œì„¤ ê±°ì£¼(ì´ë ¥)ì', 'ê²½ì œìƒí™© ìš”ê±´': 'ê¸°ì´ˆìƒí™œìˆ˜ê¸‰ì/ë²•ì •ì°¨ìƒìœ„ê³„ì¸µ, ë³µì§€ì‹œì„¤ ê±°ì£¼(ì´ë ¥)ì'},
        {'ì¥í•™ê¸ˆëª…': 'ì„œìš¸í¬ë§ ì§ì—…ì „ë¬¸í•™êµ ì¥í•™ê¸ˆ', 'êµ¬ë¶„': 'ì§ì—…ì „ë¬¸í•™êµ í•™ìƒ', 'ì „ê³µ ê³„ì—´': 'ì „ê³µë¬´ê´€', 'ìš°ëŒ€ ì¡°ê±´': 'í•´ë‹¹ ì—†ìŒ', 'ê²½ì œìƒí™© ìš”ê±´': 'ê¸°ì´ˆìƒí™œìˆ˜ê¸‰ì/ë²•ì •ì°¨ìƒìœ„ê³„ì¸µ'},
        {'ì¥í•™ê¸ˆëª…': 'ì„œìš¸í¬ë§ê³ êµì§„ë¡œ ì¥í•™ê¸ˆ', 'êµ¬ë¶„': 'ê³ ë“±í•™ìƒ', 'ì „ê³µ ê³„ì—´': 'ì „ê³µë¬´ê´€', 'ìš°ëŒ€ ì¡°ê±´': 'í•´ë‹¹ ì—†ìŒ', 'ê²½ì œìƒí™© ìš”ê±´': 'ê¸°ì´ˆìƒí™œìˆ˜ê¸‰ì, ì°¨ìƒìœ„ê³„ì¸µ, ë¶í•œì´íƒˆì£¼ë¯¼, ê²½ì œì‚¬ê°ì§€ëŒ€'},
        {'ì¥í•™ê¸ˆëª…': 'ì„œìš¸í¬ë§ ì˜ˆì²´ëŠ¥ ì¥í•™ê¸ˆ', 'êµ¬ë¶„': 'ê³ ë“±í•™ìƒ', 'ì „ê³µ ê³„ì—´': 'ì˜ˆì²´ëŠ¥', 'ìš°ëŒ€ ì¡°ê±´': 'ì˜ˆì²´ëŠ¥ íŠ¹ê¸°ì', 'ê²½ì œìƒí™© ìš”ê±´': 'ê¸°ì´ˆìƒí™œìˆ˜ê¸‰ì/ë²•ì •ì°¨ìƒìœ„ê³„ì¸µ'},
        {'ì¥í•™ê¸ˆëª…': 'ì„œìš¸ê¿ˆê¸¸ì¥í•™ê¸ˆ', 'êµ¬ë¶„': 'ë¹„ì¸ê°€ ëŒ€ì•ˆêµìœ¡ê¸°ê´€ ì¬í•™ ì²­ì†Œë…„', 'ì „ê³µ ê³„ì—´': 'ì „ê³µë¬´ê´€', 'ìš°ëŒ€ ì¡°ê±´': 'í•™êµì¥ ì¶”ì²œ', 'ê²½ì œìƒí™© ìš”ê±´': 'ê¸°ì´ˆìƒí™œìˆ˜ê¸‰ì/ë²•ì •ì°¨ìƒìœ„ê³„ì¸µ, í•™êµì¥ ì¶”ì²œ'}
    ]
    return pd.DataFrame(data)

# --------------------------------------------------------------------------
# 2. ê²°ê³¼ ì¶œë ¥ í•¨ìˆ˜
# --------------------------------------------------------------------------
def display_results(result_df):
    """ê²°ê³¼ë¥¼ ìŠ¤íŠ¸ë¦¼ë¦¿ í™”ë©´ì— ì˜ˆì˜ê²Œ ì¶œë ¥í•˜ëŠ” í•¨ìˆ˜"""
    st.subheader("ğŸ† ì¶”ì²œ ì¥í•™ê¸ˆ ê²°ê³¼")
    if result_df.empty:
        st.info("âœ… ì•„ì‰½ì§€ë§Œ í˜„ì¬ ì¡°ê±´ì— ë§ëŠ” ì¥í•™ê¸ˆì´ ì—†ìŠµë‹ˆë‹¤.")
    else:
        st.success(f"ì´ {len(result_df)}ê°œì˜ ì¥í•™ê¸ˆì„ ì¶”ì²œí•©ë‹ˆë‹¤!")
        result_df_display = result_df.drop(columns=['êµ¬ë¶„'], errors='ignore')
        st.dataframe(result_df_display, hide_index=True)

# --------------------------------------------------------------------------
# 3. ë©”ì¸ í”„ë¡œê·¸ë¨ ë¡œì§
# --------------------------------------------------------------------------
def main():
    df = create_scholarship_df()

    # --- âœ¨ ìƒ‰ìƒ ì½”ë“œê°€ ì´ ë¶€ë¶„ì—ì„œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤! ---
    st.markdown(
        """
        <style>
        .stApp {
            background-color: #ffd240;
        }
        </style>
        """,
        unsafe_allow_html=True
    )
    # -------------------------------------------

    st.title("âœ¨ ë‚˜ì—ê²Œ ë§ëŠ” ì„œìš¸ ì¥í•™ê¸ˆ ì¶”ì²œ")
    st.write("ê°„ë‹¨í•œ ì§ˆë¬¸ì— ë‹µë³€í•˜ê³ , ë‚˜ì—ê²Œ ë”± ë§ëŠ” ì¥í•™ê¸ˆì„ ì°¾ì•„ë³´ì„¸ìš”!")

    main_type = st.selectbox("í•™ìƒ êµ¬ë¶„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.", ['--ì„ íƒ--', 'ëŒ€í•™ì›ìƒ', 'ëŒ€í•™ìƒ', 'ê³ ë“±í•™ìƒ'])

    if main_type == 'ëŒ€í•™ì›ìƒ':
        result_df = df[df['êµ¬ë¶„'] == 'ëŒ€í•™ì›ìƒ']
        display_results(result_df)

    elif main_type == 'ëŒ€í•™ìƒ':
        student_type_map = {'ëŒ€í•™ìƒ': ['ëŒ€í•™ìƒ', 'ëŒ€í•™ ì‹ ì…ìƒ', 'ì§ì—…ì „ë¬¸í•™êµ í•™ìƒ']}
        possible_statuses = student_type_map['ëŒ€í•™ìƒ']
        filtered_df = df[df['êµ¬ë¶„'].isin(possible_statuses)].copy()

        status_options = ['--ì„ íƒ--'] + sorted(list(filtered_df['êµ¬ë¶„'].unique()))
        user_status = st.selectbox("ì¡°ê¸ˆ ë” ìƒì„¸í•œ ì‹ ë¶„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.", status_options)

        if user_status != '--ì„ íƒ--':
            if user_status == 'ì§ì—…ì „ë¬¸í•™êµ í•™ìƒ':
                result_df = df[df['êµ¬ë¶„'] == 'ì§ì—…ì „ë¬¸í•™êµ í•™ìƒ']
                display_results(result_df)
            else:
                filtered_df = filtered_df[filtered_df['êµ¬ë¶„'] == user_status]
                
                condition_options = [
                    'ê¸°ì´ˆìƒí™œìˆ˜ê¸‰ì/ë²•ì •ì°¨ìƒìœ„ê³„ì¸µ', 'í•™ìê¸ˆì§€ì› 4êµ¬ê°„ ì´ë‚´',
                    'ì‚¬íšŒê³µí—Œí™œë™ ê²½í—˜ì', 'ë…ë¦½ìœ ê³µì í›„ì† (4~6ëŒ€)',
                    'í•´ì™¸êµí™˜í•™ìƒìœ¼ë¡œ ì„ ë°œëœ ì'
                ]
                if user_status == 'ëŒ€í•™ ì‹ ì…ìƒ':
                    condition_options.append('ë³µì§€ì‹œì„¤ ê±°ì£¼(ì´ë ¥)ì')
                
                user_conditions = st.multiselect("í•´ë‹¹í•˜ëŠ” ëª¨ë“  ì¡°ê±´ì„ ì„ íƒí•´ì£¼ì„¸ìš”. (ì—†ìœ¼ë©´ ì„ íƒí•˜ì§€ ì•ŠìŒ)", condition_options)
                
                final_recommendations = []
                for _, row in filtered_df.iterrows():
                    all_required = row['ìš°ëŒ€ ì¡°ê±´'] + ", " + row['ê²½ì œìƒí™© ìš”ê±´']
                    if not user_conditions and 'í•´ë‹¹ ì—†ìŒ' in all_required:
                        final_recommendations.append(row)
                    elif any(cond in all_required for cond in user_conditions):
                        final_recommendations.append(row)
                display_results(pd.DataFrame(final_recommendations))

    elif main_type == 'ê³ ë“±í•™ìƒ':
        possible_statuses = ['ê³ ë“±í•™ìƒ', 'ë¹„ì¸ê°€ ëŒ€ì•ˆêµìœ¡ê¸°ê´€ ì¬í•™ ì²­ì†Œë…„']
        filtered_df = df[df['êµ¬ë¶„'].isin(possible_statuses)].copy()
        
        status_options = ['--ì„ íƒ--'] + sorted(list(filtered_df['êµ¬ë¶„'].unique()))
        user_status = st.selectbox("ì¡°ê¸ˆ ë” ìƒì„¸í•œ ì‹ ë¶„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.", status_options)

        if user_status != '--ì„ íƒ--':
            if user_status == 'ë¹„ì¸ê°€ ëŒ€ì•ˆêµìœ¡ê¸°ê´€ ì¬í•™ ì²­ì†Œë…„':
                result_df = df[df['êµ¬ë¶„'] == user_status]
                display_results(result_df)
            else:
                filtered_df = filtered_df[filtered_df['êµ¬ë¶„'] == user_status]
                
                user_major = st.selectbox("ì „ê³µ ê³„ì—´ì„ ì„ íƒí•´ì£¼ì„¸ìš”.", ['--ì„ íƒ--', 'ì˜ˆì²´ëŠ¥', 'ê¸°íƒ€'])
                
                if user_major != '--ì„ íƒ--':
                    eco_options = [
                        '--ì„ íƒ--', 'ê¸°ì´ˆìƒí™œìˆ˜ê¸‰ì ë˜ëŠ” ë²•ì •ì°¨ìƒìœ„ê³„ì¸µ', 'ë¶í•œì´íƒˆì£¼ë¯¼',
                        'ìœ„ì— í•´ë‹¹í•˜ì§€ ì•Šì§€ë§Œ ê²½ì œì  ì§€ì›ì´ í•„ìš”í•œ ìƒí™© (ê²½ì œì‚¬ê°ì§€ëŒ€ ë“±)', 'í•´ë‹¹ ì—†ìŒ'
                    ]
                    user_eco_choice = st.selectbox("ê²½ì œì  ìƒí™©ì— ê°€ì¥ ê°€ê¹Œìš´ í•­ëª©ì„ ì„ íƒí•´ì£¼ì„¸ìš”.", eco_options)
                    
                    if user_eco_choice != '--ì„ íƒ--':
                        user_eco_conditions = []
                        if user_eco_choice == eco_options[1]: user_eco_conditions = ['ê¸°ì´ˆìƒí™œìˆ˜ê¸‰ì', 'ì°¨ìƒìœ„ê³„ì¸µ', 'ë²•ì •ì°¨ìƒìœ„ê³„ì¸µ']
                        elif user_eco_choice == eco_options[2]: user_eco_conditions = ['ë¶í•œì´íƒˆì£¼ë¯¼']
                        elif user_eco_choice == eco_options[3]: user_eco_conditions = ['ê²½ì œì‚¬ê°ì§€ëŒ€']

                        final_recommendations = []
                        for _, row in filtered_df.iterrows():
                            if user_major == 'ì˜ˆì²´ëŠ¥' and row['ì „ê³µ ê³„ì—´'] != 'ì˜ˆì²´ëŠ¥': continue
                            if user_major == 'ê¸°íƒ€' and row['ì „ê³µ ê³„ì—´'] == 'ì˜ˆì²´ëŠ¥': continue
                            
                            req_eco = row['ê²½ì œìƒí™© ìš”ê±´']
                            if req_eco != 'í•´ë‹¹ ì—†ìŒ' and not any(cond in req_eco for cond in user_eco_conditions): continue
                            if req_eco == 'í•´ë‹¹ ì—†ìŒ' and user_eco_choice != 'í•´ë‹¹ ì—†ìŒ': continue

                            final_recommendations.append(row)
                        display_results(pd.DataFrame(final_recommendations))

# --------------------------------------------------------------------------
# 4. í”„ë¡œê·¸ë¨ ì‹¤í–‰
# --------------------------------------------------------------------------
if __name__ == "__main__":
    main()