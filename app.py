import streamlit as st
import pandas as pd

# --------------------------------------------------------------------------
# 1. ì¥í•™ê¸ˆ ë°ì´í„°ë² ì´ìŠ¤ ìƒì„± (ìµœì‹  ì •ë³´ ë°˜ì˜)
# --------------------------------------------------------------------------
def create_scholarship_df():
    """
    ì¥í•™ê¸ˆ ë°ì´í„°ë¥¼ pandas DataFrameìœ¼ë¡œ ìƒì„±í•˜ëŠ” í•¨ìˆ˜
    """
    data = [
        # ëŒ€í•™ì›ìƒ
        {'ì¥í•™ê¸ˆëª…': 'AIì„œìš¸í…Œí¬ ëŒ€í•™ì› ì¥í•™ê¸ˆ', 'êµ¬ë¶„': 'ëŒ€í•™ì›ìƒ', 'í•™ë…„ ì •ë³´': 'ëŒ€í•™ì› ì¬í•™ìƒ', 'ì „ê³µ ê³„ì—´': 'AI/ì´ê³µê³„', 'í•„ìˆ˜ ì¡°ê±´': 'í•´ë‹¹ ì—†ìŒ', 'ê²½ì œìƒí™© ìš”ê±´': 'í•´ë‹¹ ì—†ìŒ'},
        
        # ëŒ€í•™ìƒ
        {'ì¥í•™ê¸ˆëª…': 'ì„œìš¸í¬ë§ ëŒ€í•™ì§„ë¡œ ì¥í•™ê¸ˆ', 'êµ¬ë¶„': 'ëŒ€í•™ìƒ', 'í•™ë…„ ì •ë³´': 'ì‹ ì…ìƒ(1í•™ë…„), ì¬í•™ìƒ(2í•™ë…„ ì´ìƒ)', 'ì „ê³µ ê³„ì—´': 'ì „ê³µë¬´ê´€', 'í•„ìˆ˜ ì¡°ê±´': 'í•´ë‹¹ ì—†ìŒ', 'ê²½ì œìƒí™© ìš”ê±´': 'ê¸°ì´ˆìƒí™œìˆ˜ê¸‰ì/ë²•ì •ì°¨ìƒìœ„ê³„ì¸µ, í•™ìê¸ˆì§€ì› 4êµ¬ê°„ ì´ë‚´'},
        {'ì¥í•™ê¸ˆëª…': 'ì„œìš¸í¬ë§ ê³µìµì¸ì¬ ì¥í•™ê¸ˆ', 'êµ¬ë¶„': 'ëŒ€í•™ìƒ', 'í•™ë…„ ì •ë³´': 'ì¬í•™ìƒ(2í•™ë…„ ì´ìƒ)', 'ì „ê³µ ê³„ì—´': 'ì „ê³µë¬´ê´€', 'í•„ìˆ˜ ì¡°ê±´': 'ì‚¬íšŒê³µí—Œí™œë™ ê²½í—˜ì', 'ê²½ì œìƒí™© ìš”ê±´': 'í•´ë‹¹ ì—†ìŒ'},
        {'ì¥í•™ê¸ˆëª…': 'ë…ë¦½ìœ ê³µì í›„ì† ì¥í•™ê¸ˆ', 'êµ¬ë¶„': 'ëŒ€í•™ìƒ', 'í•™ë…„ ì •ë³´': 'ì‹ ì…ìƒ(1í•™ë…„), ì¬í•™ìƒ(2í•™ë…„ ì´ìƒ)', 'ì „ê³µ ê³„ì—´': 'ì „ê³µë¬´ê´€', 'í•„ìˆ˜ ì¡°ê±´': 'ë…ë¦½ìœ ê³µì í›„ì† (4~6ëŒ€)', 'ê²½ì œìƒí™© ìš”ê±´': 'í•´ë‹¹ ì—†ìŒ'},
        {'ì¥í•™ê¸ˆëª…': 'ì„œìš¸ í•´ì™¸êµí™˜í•™ìƒ ì¥í•™ê¸ˆ', 'êµ¬ë¶„': 'ëŒ€í•™ìƒ', 'í•™ë…„ ì •ë³´': 'ì¬í•™ìƒ(2í•™ë…„ ì´ìƒ)', 'ì „ê³µ ê³„ì—´': 'ì „ê³µë¬´ê´€', 'í•„ìˆ˜ ì¡°ê±´': 'í•´ì™¸êµí™˜í•™ìƒìœ¼ë¡œ ì„ ë°œëœ ì', 'ê²½ì œìƒí™© ìš”ê±´': 'ê¸°ì´ˆìƒí™œìˆ˜ê¸‰ì/ë²•ì •ì°¨ìƒìœ„ê³„ì¸µ, í•™ìê¸ˆì§€ì› 4êµ¬ê°„ ì´ë‚´'},
        {'ì¥í•™ê¸ˆëª…': 'ì²­ì¶˜Start ì¥í•™ê¸ˆ', 'êµ¬ë¶„': 'ëŒ€í•™ìƒ', 'í•™ë…„ ì •ë³´': 'ì‹ ì…ìƒ(1í•™ë…„)', 'ì „ê³µ ê³„ì—´': 'ì „ê³µë¬´ê´€', 'í•„ìˆ˜ ì¡°ê±´': 'í•´ë‹¹ ì—†ìŒ', 'ê²½ì œìƒí™© ìš”ê±´': 'ê¸°ì´ˆìƒí™œìˆ˜ê¸‰ì/ë²•ì •ì°¨ìƒìœ„ê³„ì¸µ, ì•„ë™ë³µì§€ì‹œì„¤ í‡´ì†Œì'},
        {'ì¥í•™ê¸ˆëª…': 'ì„œìš¸í¬ë§ ì§ì—…ì „ë¬¸í•™êµ ì¥í•™ê¸ˆ', 'êµ¬ë¶„': 'ëŒ€í•™ìƒ', 'í•™ë…„ ì •ë³´': 'ì§ì—…ì „ë¬¸í•™êµ í•™ìƒ', 'ì „ê³µ ê³„ì—´': 'ì „ê³µë¬´ê´€', 'í•„ìˆ˜ ì¡°ê±´': 'í•´ë‹¹ ì—†ìŒ', 'ê²½ì œìƒí™© ìš”ê±´': 'ê¸°ì´ˆìƒí™œìˆ˜ê¸‰ì/ë²•ì •ì°¨ìƒìœ„ê³„ì¸µ'},

        # ê³ ë“±í•™ìƒ
        {'ì¥í•™ê¸ˆëª…': 'ì„œìš¸í¬ë§ê³ êµì§„ë¡œ ì¥í•™ê¸ˆ', 'êµ¬ë¶„': 'ê³ ë“±í•™ìƒ', 'í•™ë…„ ì •ë³´': 'ê³ ë“±í•™êµ ì¬í•™ìƒ', 'ì „ê³µ ê³„ì—´': 'ì „ê³µë¬´ê´€', 'í•„ìˆ˜ ì¡°ê±´': 'í•´ë‹¹ ì—†ìŒ', 'ê²½ì œìƒí™© ìš”ê±´': 'ê¸°ì´ˆìƒí™œìˆ˜ê¸‰ì, ì°¨ìƒìœ„ê³„ì¸µ, ë¶í•œì´íƒˆì£¼ë¯¼, ê²½ì œì‚¬ê°ì§€ëŒ€'},
        {'ì¥í•™ê¸ˆëª…': 'ì„œìš¸í¬ë§ ì˜ˆì²´ëŠ¥ ì¥í•™ê¸ˆ', 'êµ¬ë¶„': 'ê³ ë“±í•™ìƒ', 'í•™ë…„ ì •ë³´': 'ê³ ë“±í•™êµ ì¬í•™ìƒ', 'ì „ê³µ ê³„ì—´': 'ì˜ˆì²´ëŠ¥', 'í•„ìˆ˜ ì¡°ê±´': 'ì˜ˆì²´ëŠ¥ íŠ¹ê¸°ì', 'ê²½ì œìƒí™© ìš”ê±´': 'ê¸°ì´ˆìƒí™œìˆ˜ê¸‰ì/ë²•ì •ì°¨ìƒìœ„ê³„ì¸µ, í•™êµì¥ ì¶”ì²œ ë°›ì€ í•™ìƒ'},
        {'ì¥í•™ê¸ˆëª…': 'ì„œìš¸ê¿ˆê¸¸ì¥í•™ê¸ˆ', 'êµ¬ë¶„': 'ê³ ë“±í•™ìƒ', 'í•™ë…„ ì •ë³´': 'ë¹„ì¸ê°€ ëŒ€ì•ˆêµìœ¡ê¸°ê´€ ì¬í•™ ì²­ì†Œë…„', 'ì „ê³µ ê³„ì—´': 'ì „ê³µë¬´ê´€', 'í•„ìˆ˜ ì¡°ê±´': 'í•™êµì¥ ì¶”ì²œ', 'ê²½ì œìƒí™© ìš”ê±´': 'ê¸°ì´ˆìƒí™œìˆ˜ê¸‰ì/ë²•ì •ì°¨ìƒìœ„ê³„ì¸µ, í•™êµì¥ ì¶”ì²œ'}
    ]
    return pd.DataFrame(data)

# --------------------------------------------------------------------------
# 2. ê²°ê³¼ ì¶œë ¥ í•¨ìˆ˜
# --------------------------------------------------------------------------
def display_results(result_df):
    st.subheader("ğŸ† ì¶”ì²œ ì¥í•™ê¸ˆ ê²°ê³¼")
    if result_df.empty:
        st.info("âœ… ì•„ì‰½ì§€ë§Œ í˜„ì¬ ì¡°ê±´ì— ë§ëŠ” ì¥í•™ê¸ˆì´ ì—†ìŠµë‹ˆë‹¤.")
    else:
        st.success(f"ì´ {len(result_df)}ê°œì˜ ì¥í•™ê¸ˆì„ ì¶”ì²œí•©ë‹ˆë‹¤!")
        result_df_display = result_df.drop(columns=['êµ¬ë¶„', 'í•™ë…„ ì •ë³´'], errors='ignore')
        st.dataframe(result_df_display, hide_index=True)

# --------------------------------------------------------------------------
# 3. ë©”ì¸ í”„ë¡œê·¸ë¨ ë¡œì§
# --------------------------------------------------------------------------
def main():
    df = create_scholarship_df()
    st.markdown(
        """
        <style>
        .stApp { background-color: #ffd240; }
        </style>
        """,
        unsafe_allow_html=True
    )

    st.title("âœ¨ ë‚˜ì—ê²Œ ë§ëŠ” ì„œìš¸ ì¥í•™ê¸ˆ ì¶”ì²œ")
    st.write("ê°„ë‹¨í•œ ì§ˆë¬¸ì— ë‹µë³€í•˜ê³ , ë‚˜ì—ê²Œ ë”± ë§ëŠ” ì¥í•™ê¸ˆì„ ì°¾ì•„ë³´ì„¸ìš”!")

    main_type = st.selectbox("í•™ìƒ êµ¬ë¶„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.", ['--ì„ íƒ--', 'ëŒ€í•™ì›ìƒ', 'ëŒ€í•™ìƒ', 'ê³ ë“±í•™ìƒ'])

    if main_type == '--ì„ íƒ--': return

    filtered_df = df[df['êµ¬ë¶„'] == main_type].copy()

    if main_type == 'ëŒ€í•™ì›ìƒ':
        display_results(filtered_df)
        return

    # --- âœ¨ ëŒ€í•™ìƒ ë¡œì§ ìˆ˜ì • ---
    if main_type == 'ëŒ€í•™ìƒ':
        status_options = ['--ì„ íƒ--', 'ì‹ ì…ìƒ(1í•™ë…„)', 'ì¬í•™ìƒ(2í•™ë…„ ì´ìƒ)', 'ì§ì—…ì „ë¬¸í•™êµ í•™ìƒ']
        user_status = st.selectbox("í•™ë…„ ì •ë³´ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.", status_options)

        if user_status == '--ì„ íƒ--': return

        filtered_df = filtered_df[filtered_df['í•™ë…„ ì •ë³´'].str.contains(user_status, na=False)]
        
        unique_conditions = set()
        for _, row in filtered_df.iterrows():
            conditions = row['í•„ìˆ˜ ì¡°ê±´'].split(', ') + row['ê²½ì œìƒí™© ìš”ê±´'].split(', ')
            unique_conditions.update(c.strip() for c in conditions if c != 'í•´ë‹¹ ì—†ìŒ')
        
        user_conditions = []
        if unique_conditions:
            user_conditions = st.multiselect("í•´ë‹¹í•˜ëŠ” ëª¨ë“  ì¡°ê±´ì„ ì„ íƒí•´ì£¼ì„¸ìš”.", sorted(list(unique_conditions)))

        final_recommendations = []
        for _, row in filtered_df.iterrows():
            all_required = row['í•„ìˆ˜ ì¡°ê±´'] + ", " + row['ê²½ì œìƒí™© ìš”ê±´']
            is_eligible = False
            if not user_conditions and 'í•´ë‹¹ ì—†ìŒ' in all_required:
                is_eligible = True
            elif any(cond in all_required for cond in user_conditions):
                is_eligible = True
            if is_eligible:
                final_recommendations.append(row)
        display_results(pd.DataFrame(final_recommendations))

    # --- âœ¨ ê³ ë“±í•™ìƒ ë¡œì§ ìˆ˜ì • ---
    elif main_type == 'ê³ ë“±í•™ìƒ':
        status_options = ['--ì„ íƒ--', 'ê³ ë“±í•™êµ ì¬í•™ìƒ', 'ë¹„ì¸ê°€ ëŒ€ì•ˆêµìœ¡ê¸°ê´€ ì¬í•™ ì²­ì†Œë…„']
        user_status = st.selectbox("ì¡°ê¸ˆ ë” ìƒì„¸í•œ ì‹ ë¶„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.", status_options)

        if user_status == '--ì„ íƒ--': return

        if user_status == 'ë¹„ì¸ê°€ ëŒ€ì•ˆêµìœ¡ê¸°ê´€ ì¬í•™ ì²­ì†Œë…„':
            display_results(df[df['í•™ë…„ ì •ë³´'] == user_status])
            return

        filtered_df = filtered_df[filtered_df['í•™ë…„ ì •ë³´'] == user_status]
        
        user_major = st.selectbox("ì „ê³µ ê³„ì—´ì„ ì„ íƒí•´ì£¼ì„¸ìš”.", ['--ì„ íƒ--', 'ì˜ˆì²´ëŠ¥', 'ê¸°íƒ€'])
        if user_major == '--ì„ íƒ--': return
        
        eco_options = [
            '--ì„ íƒ--', 'ê¸°ì´ˆìƒí™œìˆ˜ê¸‰ì ë˜ëŠ” ë²•ì •ì°¨ìƒìœ„ê³„ì¸µ', 'ë¶í•œì´íƒˆì£¼ë¯¼',
            'ìœ„ì— í•´ë‹¹í•˜ì§€ ì•Šì§€ë§Œ ê²½ì œì  ì§€ì›ì´ í•„ìš”í•œ ìƒí™© (ê²½ì œì‚¬ê°ì§€ëŒ€ ë“±)', 'í•´ë‹¹ ì—†ìŒ'
        ]
        user_eco_choice = st.selectbox("ê²½ì œì  ìƒí™©ì„ ì„ íƒí•´ì£¼ì„¸ìš”.", eco_options)
        if user_eco_choice == '--ì„ íƒ--': return

        user_eco_conditions = []
        if user_eco_choice == eco_options[1]: user_eco_conditions = ['ê¸°ì´ˆìƒí™œìˆ˜ê¸‰ì', 'ì°¨ìƒìœ„ê³„ì¸µ', 'ë²•ì •ì°¨ìƒìœ„ê³„ì¸µ']
        elif user_eco_choice == eco_options[2]: user_eco_conditions = ['ë¶í•œì´íƒˆì£¼ë¯¼']
        elif user_eco_choice == eco_options[3]: user_eco_conditions = ['ê²½ì œì‚¬ê°ì§€ëŒ€']

        # í•™êµì¥ ì¶”ì²œ ë° íŠ¹ê¸°ì ì§ˆë¬¸ ì¶”ê°€
        special_conditions = st.multiselect("í•´ë‹¹í•˜ëŠ” ì¡°ê±´ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.", ['ì˜ˆì²´ëŠ¥ íŠ¹ê¸°ì', 'í•™êµì¥ ì¶”ì²œ ë°›ì€ í•™ìƒ'])

        final_recommendations = []
        for _, row in filtered_df.iterrows():
            if user_major == 'ì˜ˆì²´ëŠ¥' and row['ì „ê³µ ê³„ì—´'] != 'ì˜ˆì²´ëŠ¥': continue
            if user_major == 'ê¸°íƒ€' and row['ì „ê³µ ê³„ì—´'] == 'ì˜ˆì²´ëŠ¥': continue
            
            all_required = row['í•„ìˆ˜ ì¡°ê±´'] + ", " + row['ê²½ì œìƒí™© ìš”ê±´']

            # í•„ìˆ˜ ì¡°ê±´ ì²´í¬
            has_special_req = False
            for cond in special_conditions:
                if cond in all_required:
                    has_special_req = True
            if not special_conditions and 'í•´ë‹¹ ì—†ìŒ' not in row['í•„ìˆ˜ ì¡°ê±´']: # ì‚¬ìš©ìê°€ ì„ íƒ ì•ˆí–ˆëŠ”ë° í•„ìˆ˜ì¡°ê±´ì´ ìˆìœ¼ë©´ íƒˆë½
                continue
            if special_conditions and not has_special_req: # ì‚¬ìš©ìê°€ ì„ íƒí–ˆëŠ”ë° í•„ìˆ˜ì¡°ê±´ì´ ì•ˆë§ìœ¼ë©´ íƒˆë½
                continue


            # ê²½ì œìƒí™© ìš”ê±´ ì²´í¬
            req_eco = row['ê²½ì œìƒí™© ìš”ê±´']
            if user_eco_choice != 'í•´ë‹¹ ì—†ìŒ' and not any(cond in req_eco for cond in user_eco_conditions):
                continue
            if user_eco_choice == 'í•´ë‹¹ ì—†ìŒ' and req_eco != 'í•´ë‹¹ ì—†ìŒ':
                 continue

            final_recommendations.append(row)
        
        display_results(pd.DataFrame(final_recommendations))

# --------------------------------------------------------------------------
# 4. í”„ë¡œê·¸ë¨ ì‹¤í–‰
# --------------------------------------------------------------------------
if __name__ == "__main__":
    main()
